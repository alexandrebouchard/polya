<!-- File generated by tutorialj -->
# polya

Installing from source
----------------------

Requires: gradle, git, eclipse

- Clone the repository
- Type ``gradle eclipse`` from the root of the repository
- From eclipse:
  - ``Import`` in ``File`` menu
  - ``Import existing projects into workspace``
  - Select the root of the newly created repo
  - Deselect ``Copy projects into workspace`` to avoid having duplicates
- You can call polya.Main from the command line via ``./polya``
  - Move the executable ``polya`` to a PATH folder (or add this folder to PATH)
  to have access from anywhere
  - Changes done via eclipse will be reflected right away

Usage
-----

To run the software:

```java
// TODO
```

CRP State
---------


``CRPState`` is exactly like the version we worked on 
during Lab 3, except for a few minor modifications:

1. Instead of denoting each cluster with an ``Integer``, we 
use ``ClusterId`` instead. This is to avoid potential errors
of mixing up customer id (which are still integers) and cluster id.
In other words such error
will now be detected at compile time instead of running time.
This is generally a good principle: trying to discover problems as 
early as possible (fail fast).
2. CRPState now has an extra responsibility: keeping sufficient 
statistics for each table (cluster).

You will have one small task to perform in order to make the test case below work.
To run the test case, right click on the class in the left-hand panel,
here under ``src/test/java/polya/CRPStateTutorial``, select ``Run as``, 
and pick ``JUnit test``. You should see a red flag until you make 
the change described below work, in which case the flag will become green.
Such test case can be created by simply adding the ``@Test`` 
flag above the function you want to test.

```java
CRPState state = new CRPState(NIWs.loadFromCSVFile(new File("data/tiny-data.csv")));

state.checkIntegrity();
state.addCustomerToNewTable(0);
state.checkIntegrity();
state.addCustomerToExistingTable(1, state.getClusterIdOfCustomer(0));
state.checkIntegrity();
// This means that the flag will go red if these two are not equal
Assert.assertEquals(state.partition(), part(block(0,1)));

state.addCustomerToNewTable(2);
state.checkIntegrity();
Assert.assertEquals(state.nTables(), 2);
Assert.assertEquals(state.nCustomers(), 3);
state.removeCustomer(2);
state.checkIntegrity();
Assert.assertEquals(state.nTables(), 1);
Assert.assertEquals(state.nCustomers(), 2);
state.removeCustomer(1);
state.checkIntegrity();
state.addCustomerToExistingTable(3, state.getClusterIdOfCustomer(0));
Assert.assertEquals(state.partition(), part(block(0,3)));    
state.checkIntegrity();
```
<sub>From:[polya.CRPStateTutorial](src/main/java//polya/CRPStateTutorial.java)</sub>

This is the first function you should fill in.
You can base what you write on your work from the lab, but make
sure you also update ``cluster2Statistic``.

You can get some information on how to do this by looking
at how I modified ``addCustomerToNewTable()`` and 
``addCustomerToExistingTable()``. See also the class
``SufficientStatistic`` (to open a class, go in the menu
``Navigate`` then ``Open Type`` and just type ``SufficientStatistic``)

Recall also that ``removeCustomer()`` should behave as follows:

Remove customer, destroying the table if the customer was the last.
@param customer Customer to remove
@throws RuntimeException If customer was not in restaurant

```java
public void removeCustomer(java.lang.Integer)
```

Parametric machinery
--------------------

Each cluster in a DP has its own mini parametric model. You
will develop this mini parametric model in the case of a
Normal-inverse-Wishart prior coupled with a Normal likelihood,
and perhaps others if time permits.


For the next test case to run, you will need to implement 
the NIW conjugacy machinery. The main things to do will
be in ``Parametrics``, which contains some behaviors that 
applies to all conjugate models, and in ``CollapsedNIWModel``,
which contains behaviors specific to NIW.


Computes p_hp(data), marginalizing over parameters. See Equation (12,13) in
http://www.stat.ubc.ca/~bouchard/courses/stat547-sp2013-14/lecture/2014/01/12/notes-lecture3.html

@param model A conjugate model.
@param hp The hyper-parameter
@param data
@return

```java
public static double logMarginal(polya.parametric.CollapsedConjugateModel,polya.parametric.HyperParameter,polya.parametric.SufficientStatistic)
```


@param model
@param hp
@param newPoints
@param oldPoints
@return

```java
public static double logPredictive(polya.parametric.CollapsedConjugateModel,polya.parametric.HyperParameter,polya.parametric.SufficientStatistic,polya.parametric.SufficientStatistic)
```

Glossary and abbreviations
--------------------------

General:

- Class with a plural name/ending in s (Maps, Parametrics, etc): 
  Contains static functions, usually utilities.

Specific to this project:

- diagDelta: One of the NIW hyper-parameters. See NIWHyperParameters
- kappa: One of the NIW hyper-parameters. See NIWHyperParameters
- MAP: Maximum A Posteriori. See TestedModel
- MVN: MultiVariate Normal.
- NIW: Normal Inverse Wishart. A conjugate prior for mean and var of a MVN.
- nuPrime: One of the NIW hyper-parameters. See NIWHyperParameters


